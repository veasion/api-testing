(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36e9df82"],{"1bff":function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("div",{staticClass:"form-container"},[r("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.project,"label-position":"left","label-width":"120px"}},[r("el-form-item",{staticStyle:{width:"400px"},attrs:{label:"项目名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"项目名称"},model:{value:t.project.name,callback:function(e){t.$set(t.project,"name",e)},expression:"project.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"项目描述",prop:"description"}},[r("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"项目描述"},model:{value:t.project.description,callback:function(e){t.$set(t.project,"description",e)},expression:"project.description"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"是否启用配置",prop:"isAvailable"}},[r("el-switch",{attrs:{"active-color":"#00A854","active-text":"启用","active-value":1,"inactive-color":"#F04134","inactive-text":"停用","inactive-value":0},model:{value:t.project.projectConfig.isAvailable,callback:function(e){t.$set(t.project.projectConfig,"isAvailable",e)},expression:"project.projectConfig.isAvailable"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"接口请求日志",prop:"openReqLog"}},[r("el-switch",{attrs:{"active-color":"#00A854","active-text":"开启","active-value":1,"inactive-color":"#F04134","inactive-text":"不开启","inactive-value":0},model:{value:t.project.projectConfig.openReqLog,callback:function(e){t.$set(t.project.projectConfig,"openReqLog",e)},expression:"project.projectConfig.openReqLog"}})],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:22}},[r("el-form-item",{attrs:{label:"全局参数",prop:"globalVarJson"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("span",[t._v("全局参数")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"},attrs:{title:"查看示例"},on:{click:function(e){return t.showExample("json","globalVarJson")}}})]),t._v(" "),r("json-editor",{ref:"globalVarJsonEditor",model:{value:t.project.projectConfig.globalVarJson,callback:function(e){t.$set(t.project.projectConfig,"globalVarJson",e)},expression:"project.projectConfig.globalVarJson"}})],1)],1)],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:22}},[r("el-form-item",{attrs:{label:"前置脚本",prop:"beforeScript"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("span",[t._v("前置脚本")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"},attrs:{title:"查看示例"},on:{click:function(e){return t.showExample("js","beforeScript")}}})]),t._v(" "),r("javascript-editor",{ref:"beforeScriptEditor",model:{value:t.project.projectConfig.beforeScript,callback:function(e){t.$set(t.project.projectConfig,"beforeScript",e)},expression:"project.projectConfig.beforeScript"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:2}},[r("span",{attrs:{title:"调试脚本"}},[r("svg-icon",{staticClass:"run-but",attrs:{"icon-class":"run"},nativeOn:{click:function(e){return t.runScript("beforeScript")}}})],1)])],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:22}},[r("el-form-item",{attrs:{label:"后置脚本",prop:"afterScript"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("span",[t._v("后置脚本")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"},attrs:{title:"查看示例"},on:{click:function(e){return t.showExample("js","afterScript")}}})]),t._v(" "),r("javascript-editor",{ref:"afterScriptEditor",model:{value:t.project.projectConfig.afterScript,callback:function(e){t.$set(t.project.projectConfig,"afterScript",e)},expression:"project.projectConfig.afterScript"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:2}},[r("span",{attrs:{title:"调试脚本"}},[r("svg-icon",{staticClass:"run-but",attrs:{"icon-class":"run"},nativeOn:{click:function(e){return t.runScript("afterScript")}}})],1)])],1),t._v(" "),r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:22}},[r("el-form-item",{attrs:{label:"异常监听脚本",prop:"exceptionScript"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("span",[t._v("异常监听脚本")]),t._v(" "),r("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer"},attrs:{title:"查看示例"},on:{click:function(e){return t.showExample("js","exceptionScript")}}})]),t._v(" "),r("javascript-editor",{ref:"exceptionScriptEditor",model:{value:t.project.projectConfig.exceptionScript,callback:function(e){t.$set(t.project.projectConfig,"exceptionScript",e)},expression:"project.projectConfig.exceptionScript"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:2}},[r("span",{attrs:{title:"调试脚本"}},[r("svg-icon",{staticClass:"run-but",attrs:{"icon-class":"run"},nativeOn:{click:function(e){return t.runScript("exceptionScript")}}})],1)])],1)],1)],1),t._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"10px","margin-bottom":"10px"}},[r("el-button",{attrs:{type:"primary"},on:{click:t.update}},[t._v("更新配置")])],1),t._v(" "),r("example",{ref:"example"}),t._v(" "),r("script-execute",{ref:"scriptExecute",attrs:{"before-script":!1,"after-script":!1}})],1)},n=[],s=(r("ac67"),r("1bc7"),r("32ea"),r("a450"),r("8955")),i=(r("e186"),r("e9ff")),a=r("24d2"),c=r("fa7e"),p=r("f6c2"),l=r("45d1"),u=r("2e50");function f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?f(Object(r),!0).forEach((function(e){Object(s["a"])(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={name:"ProjectConfig",components:{JsonEditor:c["a"],JavascriptEditor:p["a"],ScriptExecute:l["a"],Example:u["a"]},data:function(){return{id:null,project:{id:void 0,name:"",description:"",projectConfig:{openReqLog:1,isAvailable:1,globalVarJson:'{"baseUrl": "http://127.0.0.1:8080"}',beforeScript:"",afterScript:"",exceptionScript:""}},rules:{name:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],description:[{required:!0,message:"项目描述不能为空",trigger:"blur"}]}}},mounted:function(){this.init()},methods:{init:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.id=this.$route.params.id||this.$route.query.id,t.next=3,a["getById"](this.id);case 3:if(e=t.sent,r=e.data,r.projectConfig=r.projectConfig||g({},this.project.projectConfig),r.projectConfig.globalVarJson)try{r.projectConfig.globalVarJson=JSON.parse(r.projectConfig.globalVarJson)}catch(o){console.log(o),this.$message.error("全局参数错误，非JSON格式")}else r.projectConfig.globalVarJson={};this.project=r,this.$refs.beforeScriptEditor&&this.$refs.beforeScriptEditor.reloadTips(this.id),this.$refs.afterScriptEditor&&this.$refs.afterScriptEditor.reloadTips(this.id),this.$refs.exceptionScriptEditor&&this.$refs.exceptionScriptEditor.reloadTips(this.id);case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),update:function(){var t=this;if(this.project.projectConfig.globalVarJson)try{JSON.parse(this.project.projectConfig.globalVarJson)}catch(e){return void this.$message.error("全局参数错误，非JSON格式")}this.$confirm("确定更新项目配置吗？").then((function(){a["update"](t.project).then((function(){t.$notify({title:"Success",message:"更新成功",type:"success",duration:2e3}),t.init()}))}))},runScript:function(t){var e=this.project.projectConfig[t];if(this.project.projectConfig.globalVarJson)try{this.$refs.scriptExecute.setEnvMap(JSON.parse(this.project.projectConfig.globalVarJson))}catch(r){console.error("设置envMap错误",r)}this.$refs.scriptExecute.show(this.project.id,e)},showExample:function(t,e){var r="",o="";"globalVarJson"===e?(r="项目全局参数",o={baseUrl:"http://127.0.0.1:8080",username:"admin",password:123456,desc:"",desc1:"这是一个全局参数配置示例",desc2:"请求参数可以通过${xxx}方式替换变量",desc3:"js中可以通过env.getGlobal('xxx')获取值",desc4:"http.postJson('${baseUrl}', { username: '${username}' })"}):"beforeScript"===e?(r="前置脚本示例",o='// 该脚本是在所有脚本执行前触发，策略开始前执行\n// 脚本适用于提前登录，请求/响应拦截处理\n\n// 登录示例\nlet result = http.postJson("${baseUrl}/api/auth/login", {\n  "username": "${username}",\n  "password": "${password}"\n});\n\nlet token = result.data.token;\nlog.info(\'token: \' + token);\nenv.setGlobal("token", token);\n\n// 请求拦截处理，设置授权headers\nscriptContext.addRequestProcessor(function(request) {\n  request.addHeaders("Authorization", token);\n});\n\n// 响应拦截处理\nscriptContext.addResponseProcessor(function(response, status, log) {\n  // 这里判断请求是否成功（这里是接口失败，并不是脚本执行异常）\n  if (status == 200 && response && response.code && response.code != \'200\') {\n    // code不等于200时请求失败，修改日志状态: 2成功 3 失败\n    log.status = 3;\n\t// 记录失败日志\n    log.appendLog(response.message || "");\n  }\n});'):"afterScript"===e?(r="后置脚本示例",o="// 该脚本是在所有脚本执行后触发，策略正常执行完成后执行\n// 脚本适用于用来监听脚本执行情况\n\n// 发送钉钉群通知示例\nlet projectName = scriptContext.project.name;\nlet strategyName = scriptContext.strategy != null ? scriptContext.strategy.name : null\nif (scriptContext.strategy && scriptContext.strategy.strategy == 2) {\n\t// TODO 压测不处理\n} else {\n\t// 定时任务\n\tif (scriptContext.refLog == 2) {\n\t\t// 全部执行成功\n\t\tsendNotice(projectName + ', 策略' + strategyName + '执行通过');\n\t} else {\n\t\t// 策略执行不通过\n\t\tfor (let i in scriptContext.apiLogList) {\n\t\t\tlet apiLog = scriptContext.apiLogList[i];\n\t\t\tif (apiLog.status == 3) {\n\t\t\t\t// 执行不通过的请求\n\t\t\t\tsendNotice(projectName + ', 接口: ' + apiLog.url + ' 执行失败');\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction sendNotice(msg) {\n\t// 发送钉钉群通知\n\tlet access_token = '你的群机器人access_token';\n\thttp.postJson('https://oapi.dingtalk.com/robot/send?access_token=' + access_token, {\n\t\tmsgtype: 'text', \n\t\ttext: {\n\t\t\tcontent: '接口自动化测试：' + msg\n\t\t}\n\t});\n}"):"exceptionScript"===e&&(r="异常监听脚本示例",o="// 该脚本是在策略执行异常时触发\n// 脚本适用于异常监听通知\n\n// 发送钉钉群通知示例\nlet projectName = scriptContext.project.name;\nlet strategyName = scriptContext.strategy != null ? scriptContext.strategy.name : null\n// 发送钉钉群通知\nlet access_token = '你的群机器人access_token';\nhttp.postJson('https://oapi.dingtalk.com/robot/send?access_token=' + access_token, {\n\tmsgtype: 'text', \n\ttext: {\n\t\tcontent: '接口自动化测试：' + projectName + ', 策略' + strategyName + '执行异常'\n\t}\n});"),this.$refs.example.show(r,t,o)}}},j=d,b=(r("f478"),r("cba8")),m=Object(b["a"])(j,o,n,!1,null,"722e82e3",null);e["default"]=m.exports},e905:function(t,e,r){},f478:function(t,e,r){"use strict";r("e905")}}]);